"use strict";const j=require("react"),_=require("react-konva"),ue=require("zustand"),de=require("konva");var W={exports:{}},Y={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var re;function fe(){if(re)return Y;re=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function o(i,r,s){var c=null;if(s!==void 0&&(c=""+s),r.key!==void 0&&(c=""+r.key),"key"in r){s={};for(var l in r)l!=="key"&&(s[l]=r[l])}else s=r;return r=s.ref,{$$typeof:e,type:i,key:c,ref:r!==void 0?r:null,props:s}}return Y.Fragment=n,Y.jsx=o,Y.jsxs=o,Y}var L={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne;function me(){return ne||(ne=1,process.env.NODE_ENV!=="production"&&function(){function e(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===C?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case x:return"Fragment";case M:return"Profiler";case B:return"StrictMode";case O:return"Suspense";case P:return"SuspenseList";case T:return"Activity"}if(typeof t=="object")switch(typeof t.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),t.$$typeof){case b:return"Portal";case k:return(t.displayName||"Context")+".Provider";case U:return(t._context.displayName||"Context")+".Consumer";case w:var u=t.render;return t=t.displayName,t||(t=u.displayName||u.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case D:return u=t.displayName||null,u!==null?u:e(t.type)||"Memo";case N:u=t._payload,t=t._init;try{return e(t(u))}catch{}}return null}function n(t){return""+t}function o(t){try{n(t);var u=!1}catch{u=!0}if(u){u=console;var h=u.error,p=typeof Symbol=="function"&&Symbol.toStringTag&&t[Symbol.toStringTag]||t.constructor.name||"Object";return h.call(u,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",p),n(t)}}function i(t){if(t===x)return"<>";if(typeof t=="object"&&t!==null&&t.$$typeof===N)return"<...>";try{var u=e(t);return u?"<"+u+">":"<...>"}catch{return"<...>"}}function r(){var t=E.A;return t===null?null:t.getOwner()}function s(){return Error("react-stack-top-frame")}function c(t){if(A.call(t,"key")){var u=Object.getOwnPropertyDescriptor(t,"key").get;if(u&&u.isReactWarning)return!1}return t.key!==void 0}function l(t,u){function h(){Z||(Z=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",u))}h.isReactWarning=!0,Object.defineProperty(t,"key",{get:h,configurable:!0})}function a(){var t=e(this.type);return K[t]||(K[t]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),t=this.props.ref,t!==void 0?t:null}function f(t,u,h,p,I,S,q,X){return h=S.ref,t={$$typeof:m,type:t,key:u,props:S,_owner:I},(h!==void 0?h:null)!==null?Object.defineProperty(t,"ref",{enumerable:!1,get:a}):Object.defineProperty(t,"ref",{enumerable:!1,value:null}),t._store={},Object.defineProperty(t._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(t,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(t,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:q}),Object.defineProperty(t,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:X}),Object.freeze&&(Object.freeze(t.props),Object.freeze(t)),t}function g(t,u,h,p,I,S,q,X){var y=u.children;if(y!==void 0)if(p)if(J(y)){for(p=0;p<y.length;p++)R(y[p]);Object.freeze&&Object.freeze(y)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else R(y);if(A.call(u,"key")){y=e(t);var F=Object.keys(u).filter(function(le){return le!=="key"});p=0<F.length?"{key: someKey, "+F.join(": ..., ")+": ...}":"{key: someKey}",te[y+p]||(F=0<F.length?"{"+F.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,p,y,F,y),te[y+p]=!0)}if(y=null,h!==void 0&&(o(h),y=""+h),c(u)&&(o(u.key),y=""+u.key),"key"in u){h={};for(var z in u)z!=="key"&&(h[z]=u[z])}else h=u;return y&&l(h,typeof t=="function"?t.displayName||t.name||"Unknown":t),f(t,y,S,I,r(),h,q,X)}function R(t){typeof t=="object"&&t!==null&&t.$$typeof===m&&t._store&&(t._store.validated=1)}var v=j,m=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),U=Symbol.for("react.consumer"),k=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),C=Symbol.for("react.client.reference"),E=v.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,A=Object.prototype.hasOwnProperty,J=Array.isArray,$=console.createTask?console.createTask:function(){return null};v={"react-stack-bottom-frame":function(t){return t()}};var Z,K={},Q=v["react-stack-bottom-frame"].bind(v,s)(),ee=$(i(s)),te={};L.Fragment=x,L.jsx=function(t,u,h,p,I){var S=1e4>E.recentlyCreatedOwnerStacks++;return g(t,u,h,!1,p,I,S?Error("react-stack-top-frame"):Q,S?$(i(t)):ee)},L.jsxs=function(t,u,h,p,I){var S=1e4>E.recentlyCreatedOwnerStacks++;return g(t,u,h,!0,p,I,S?Error("react-stack-top-frame"):Q,S?$(i(t)):ee)}}()),L}var oe;function he(){return oe||(oe=1,process.env.NODE_ENV==="production"?W.exports=fe():W.exports=me()),W.exports}var d=he();const se=e=>Symbol.iterator in e,ie=e=>"entries"in e,ae=(e,n)=>{const o=e instanceof Map?e:new Map(e.entries()),i=n instanceof Map?n:new Map(n.entries());if(o.size!==i.size)return!1;for(const[r,s]of o)if(!Object.is(s,i.get(r)))return!1;return!0},be=(e,n)=>{const o=e[Symbol.iterator](),i=n[Symbol.iterator]();let r=o.next(),s=i.next();for(;!r.done&&!s.done;){if(!Object.is(r.value,s.value))return!1;r=o.next(),s=i.next()}return!!r.done&&!!s.done};function xe(e,n){return Object.is(e,n)?!0:typeof e!="object"||e===null||typeof n!="object"||n===null?!1:!se(e)||!se(n)?ae({entries:()=>Object.entries(e)},{entries:()=>Object.entries(n)}):ie(e)&&ie(n)?ae(e,n):be(e,n)}function ge(e){const n=j.useRef(void 0);return o=>{const i=e(o);return xe(n.current,i)?n.current:n.current=i}}const pe=[{id:"block-1",x:100,y:100,width:120,height:60,label:"obj1",icon:"home"},{id:"block-2",x:300,y:100,width:120,height:60,label:"obj2",icon:"settings"},{id:"block-3",x:500,y:100,width:120,height:60,label:"obj3",icon:"memory"},{id:"block-4",x:300,y:250,width:120,height:60,label:"obj4",icon:"help"},{id:"block-5",x:100,y:250,width:120,height:60,label:"obj5",icon:"cancel"},{id:"block-6",x:500,y:250,width:120,height:60,label:"obj6",icon:"data_object"}],ce=ue.create(e=>({blocks:pe,connections:[],selectedBlockId:null,globalBlockColor:"#ffffff",actions:{setSelectedBlock:n=>e({selectedBlockId:n}),setDiagram:({elements:n,connections:o})=>e({blocks:n,connections:o,selectedBlockId:null}),updateBlockPosition:(n,o,i)=>e(r=>{const s=r.blocks.findIndex(l=>l.id===n);if(s===-1)return r;const c=[...r.blocks];return c[s]={...c[s],x:o,y:i},{blocks:c}}),setGlobalBlockColor:n=>e(o=>({globalBlockColor:n,blocks:o.blocks.map(i=>({...i,color:n}))})),addConnection:n=>e(o=>({connections:[...o.connections,n]})),removeConnectionFrom:(n,o)=>e(i=>({connections:i.connections.filter(r=>!(r.from.blockId===n&&r.from.direction===o))})),removeBlockAndConnections:n=>e(o=>({blocks:o.blocks.filter(i=>i.id!==n),connections:o.connections.filter(i=>i.from.blockId!==n&&i.to.blockId!==n),selectedBlockId:null}))}})),H=()=>ce(ge(e=>({blocks:e.blocks,connections:e.connections,selectedBlockId:e.selectedBlockId,globalBlockColor:e.globalBlockColor}))),V=()=>ce(e=>e.actions),ye=({removeConnectionFrom:e})=>{const[n,o]=j.useState(null),[i,r]=j.useState(null);return{connection:n,hoveredTargetId:i,setHoveredTargetId:r,startConnection:(a,f,g,R)=>{e(a,f),o({fromBlockId:a,fromDirection:f,startX:g,startY:R,currentX:g,currentY:R})},updatePosition:(a,f)=>{n&&o({...n,currentX:a,currentY:f})},resetConnection:()=>{o(null),r(null)}}},ke=e=>{const{x:n,y:o,width:i,height:r}=e;return[{blockId:e.id,direction:"top",x:n+i/2,y:o},{blockId:e.id,direction:"bottom",x:n+i/2,y:o+r},{blockId:e.id,direction:"left",x:n,y:o+r/2},{blockId:e.id,direction:"right",x:n+i,y:o+r/2}]},G=(e,n)=>{const{x:o,y:i,width:r,height:s}=e;switch(n){case"top":return{x:o+r/2,y:i};case"bottom":return{x:o+r/2,y:i+s};case"left":return{x:o,y:i+s/2};case"right":return{x:o+r,y:i+s/2}}},we=(e,n)=>e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height,Ee=(e,n,o,i,r)=>{const s=[[r.x,r.y,r.x+r.width,r.y],[r.x,r.y+r.height,r.x+r.width,r.y+r.height],[r.x,r.y,r.x,r.y+r.height],[r.x+r.width,r.y,r.x+r.width,r.y+r.height]],c=(l,a,f,g,R,v,m,b)=>{const x=(f-l)*(b-v)-(g-a)*(m-R);if(x===0)return!1;const B=((b-v)*(m-l)+(R-m)*(b-a))/x,M=((a-g)*(m-l)+(f-l)*(b-a))/x;return 0<B&&B<1&&0<M&&M<1};return s.some(([l,a,f,g])=>c(e,n,o,i,l,a,f,g))},je=({x:e,y:n,visible:o,onMouseDown:i})=>{const r=j.useRef(null);return j.useEffect(()=>{r.current&&r.current.to({opacity:o?1:0,duration:.25,easing:de.Easings.EaseInOut})},[o]),d.jsx(_.Circle,{ref:r,x:e,y:n,radius:6,fill:"#abc9f8",stroke:"#3B82F6",strokeWidth:2,shadowBlur:6,opacity:0,scale:{x:1.1,y:1.1},onMouseEnter:s=>{var l;s.target.to({scaleX:1.3,scaleY:1.3,duration:.1});const c=(l=s.target.getStage())==null?void 0:l.container();c&&(c.style.cursor="pointer")},onMouseLeave:s=>{var l;s.target.to({scaleX:1.1,scaleY:1.1,duration:.1});const c=(l=s.target.getStage())==null?void 0:l.container();c&&(c.style.cursor="default")},onMouseDown:s=>{s.cancelBubble=!0;const c=s.target.getAbsolutePosition().x,l=s.target.getAbsolutePosition().y;i(c,l)}})},ve=({block:e,onDragEnd:n,onStartConnect:o,onSelect:i,selected:r,isConnecting:s=!1,isTarget:c=!1,isSource:l=!1,alwaysShowPoints:a=!1})=>{const[f,g]=j.useState(!1),R=[{dir:"top",x:e.x+e.width/2,y:e.y},{dir:"bottom",x:e.x+e.width/2,y:e.y+e.height},{dir:"left",x:e.x,y:e.y+e.height/2},{dir:"right",x:e.x+e.width,y:e.y+e.height/2}],v=()=>a||l||c||f&&!s;return d.jsxs(_.Group,{onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),onClick:()=>i==null?void 0:i(e.id),draggable:!s,x:e.x,y:e.y,onDragMove:m=>{var x;const b=(x=m.target.getStage())==null?void 0:x.container();b&&(b.style.cursor="grab"),n(e.id,m.target.x(),m.target.y())},onDragEnd:m=>{var x;const b=(x=m.target.getStage())==null?void 0:x.container();b&&(b.style.cursor="default"),n(e.id,m.target.x(),m.target.y())},children:[d.jsx(_.Rect,{width:e.width,height:e.height,fill:e.color||"#ffffff",stroke:r?"#bbbbbb":s?"#4B5563":void 0,cornerRadius:7,shadowBlur:2,strokeWidth:r||s?2:0}),d.jsx(_.Text,{text:e.icon,fontSize:24,x:e.width/2-10,y:e.height/2-20,fontFamily:"Material Icons",fill:"#4B5563"}),d.jsx(_.Text,{text:e.label,fontSize:14,x:e.width/2-e.label.length*3.5,y:e.height/2+10,align:"center",fill:"#4B5563"}),v()&&R.map(m=>d.jsx(je,{x:m.x-e.x,y:m.y-e.y,visible:v(),onMouseDown:(b,x)=>o(e.id,m.dir,b,x)},m.dir))]})},Re=({blocks:e,connectionFromBlockId:n,hoveredTargetId:o,isConnecting:i,onDragEnd:r,onStartConnect:s,isBlockConnected:c,selectedBlockId:l,onSelect:a})=>d.jsx(d.Fragment,{children:e.map(f=>d.jsx(ve,{block:f,onDragEnd:r,onStartConnect:s,isConnecting:i,isSource:n===f.id,isTarget:o===f.id,alwaysShowPoints:c(f.id),selected:l===f.id,onSelect:a},f.id))}),Te=()=>d.jsxs("div",{className:"absolute bottom-4 left-4 text-sm text-gray-800 bg-white border border-gray-300 px-3 py-1 rounded shadow-md pointer-events-none select-none",children:["Press ",d.jsx("kbd",{className:"font-mono text-xs bg-gray-100 border px-1 rounded",children:"Delete"})," or"," ",d.jsx("kbd",{className:"font-mono text-xs bg-gray-100 border px-1 rounded",children:"Backspace"})," to remove a block"]}),Ce=({connections:e,blocks:n})=>d.jsx(d.Fragment,{children:e.map((o,i)=>{const r=n.find(a=>a.id===o.from.blockId),s=n.find(a=>a.id===o.to.blockId);if(!r||!s)return null;const c=G(r,o.from.direction),l=G(s,o.to.direction);return d.jsx(_.Arrow,{points:[c.x,c.y,l.x,l.y],stroke:"#3B82F6",strokeWidth:2,pointerLength:10,pointerWidth:10,lineCap:"round",lineJoin:"round"},i)})}),Se=()=>{const{blocks:e,connections:n,selectedBlockId:o}=H(),{updateBlockPosition:i,addConnection:r,removeConnectionFrom:s,setSelectedBlock:c,removeBlockAndConnections:l}=V(),{connection:a,hoveredTargetId:f,setHoveredTargetId:g,startConnection:R,updatePosition:v,resetConnection:m}=ye({removeConnectionFrom:s}),b=j.useMemo(()=>e.flatMap(ke),[e]),x=j.useCallback(k=>{var D;if(!a)return;const w=(D=k.target)==null?void 0:D.getStage(),O=w==null?void 0:w.getPointerPosition();if(!O)return;v(O.x,O.y);const P=e.find(N=>N.id!==a.fromBlockId&&we(O,N));g((P==null?void 0:P.id)||null)},[a,e,v,g]),B=j.useCallback(()=>{if(!a)return;const{fromBlockId:k,fromDirection:w,startX:O,startY:P,currentX:D,currentY:N}=a;let T=b.find(C=>{const E=C.x-D,A=C.y-N;return Math.sqrt(E*E+A*A)<12&&C.blockId!==k});if(!T&&f){const C=e.find(E=>E.id===f);if(C){const E=["top","bottom","left","right"].filter(J=>J!==w)[0],A=G(C,E);T={blockId:C.id,direction:E,...A}}}if(T){const C=e.find(E=>E.id===(T==null?void 0:T.blockId));if(C){if(Ee(O,P,T.x,T.y,C)){m();return}r({from:{blockId:k,direction:w},to:{blockId:T.blockId,direction:T.direction}})}}m()},[a,b,f,e,r,m]),M=j.useCallback(k=>{k.target===k.target.getStage()&&c(null)},[c]),U=j.useCallback(k=>n.some(w=>w.from.blockId===k||w.to.blockId===k),[n]);return j.useEffect(()=>{const k=w=>{(w.key==="Delete"||w.key==="Backspace")&&o&&l(o)};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[o,l]),d.jsxs("div",{className:"relative w-full h-screen",children:[d.jsx(_.Stage,{width:window.innerWidth,height:window.innerHeight,onMouseMove:x,onMouseUp:B,onMouseDown:M,children:d.jsxs(_.Layer,{children:[d.jsx(Re,{blocks:e,connectionFromBlockId:(a==null?void 0:a.fromBlockId)??null,hoveredTargetId:f,isConnecting:!!a,onDragEnd:i,onStartConnect:R,isBlockConnected:U,selectedBlockId:o,onSelect:c}),d.jsx(Ce,{connections:n,blocks:e}),a&&d.jsx(_.Arrow,{points:[a.startX,a.startY,a.currentX,a.currentY],stroke:"#4B5563",strokeWidth:2,lineCap:"round",lineJoin:"round"})]})}),o&&d.jsx(Te,{})]})},_e=()=>{const{blocks:e,connections:n}=H(),{setDiagram:o}=V();return{exportToJson:()=>{const s={elements:e.map(f=>({...f,color:f.color||"#ffffff"})),connections:n},c=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(c),a=document.createElement("a");a.href=l,a.download="diagram.json",a.click(),URL.revokeObjectURL(l)},importFromJson:s=>{const c=new FileReader;c.onload=l=>{var a;try{const f=JSON.parse((a=l.target)==null?void 0:a.result);if(!Array.isArray(f.elements)||!Array.isArray(f.connections)){alert("Wrong JSON structure");return}o({elements:f.elements,connections:f.connections})}catch{alert("Error while reading JSON")}},c.readAsText(s)}}},Oe=["#4F46E5","#10B981","#F59E0B","#EF4444","#3B82F6","#A855F7","#EC4899","#F97316","#22D3EE","#14B8A6"],Ie=()=>{const e=j.useRef(null),{exportToJson:n,importFromJson:o}=_e(),{globalBlockColor:i}=H(),{setGlobalBlockColor:r}=V();return d.jsxs("div",{className:"flex flex-col space-y-3 w-full",children:[d.jsx("button",{onClick:n,className:"w-full px-4 py-2 text-white border border-blue-600 rounded bg-blue-700 hover:bg-blue-800 transition-colors duration-200",children:"Export JSON"}),d.jsx("button",{onClick:()=>{var s;return(s=e.current)==null?void 0:s.click()},className:"w-full px-4 py-2 text-blue-600 border border-blue-600 rounded bg-white hover:bg-blue-100 transition-colors duration-200",children:"Import JSON"}),d.jsx("input",{ref:e,type:"file",accept:"application/json",className:"hidden",onChange:s=>{var l;const c=(l=s.target.files)==null?void 0:l[0];c&&o(c)}}),d.jsxs("div",{className:"w-full p-3 border border-gray-300 rounded bg-white",children:[d.jsx("label",{className:"text-sm block text-gray-700 mb-2",children:"Block colors:"}),d.jsx("div",{className:"flex flex-wrap gap-2",children:Oe.map((s,c)=>d.jsx("button",{onClick:()=>r(s),className:"relative w-6 h-6 rounded-full border-none outline-none cursor-pointer hover:opacity-70 transition-opacity",style:{backgroundColor:s},children:i===s&&d.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-white text-[10px] font-bold pointer-events-none",children:"✓"})},`color-${c}`))})]})]})},Pe=()=>d.jsxs("div",{className:"w-full h-screen flex overflow-hidden",children:[d.jsx("div",{className:"w-[30%] p-4 border-r border-gray-200",children:d.jsx(Ie,{})}),d.jsx("div",{className:"w-[70%] bg-gray-100 h-screen relative",children:d.jsx(Se,{})})]});module.exports=Pe;
//# sourceMappingURL=index.cjs.js.map
